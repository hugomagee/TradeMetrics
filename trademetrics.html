<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>TradeMetrics — Portfolio Analytics</title>
<link href="https://fonts.googleapis.com/css2?family=JetBrains+Mono:wght@300;400;500;600;700&family=Syne:wght@400;600;700;800&display=swap" rel="stylesheet">
<style>
  :root {
    --bg: #050810;
    --bg2: #090d1a;
    --bg3: #0e1525;
    --surface: #111827;
    --surface2: #1a2235;
    --border: #1e2d45;
    --border2: #253550;
    --accent: #00d4aa;
    --accent2: #0099ff;
    --accent3: #ff6b35;
    --red: #ff4757;
    --green: #2ed573;
    --text: #e8edf5;
    --text2: #8fa3c0;
    --text3: #4a6080;
    --gold: #ffd700;
  }

  * { margin:0; padding:0; box-sizing:border-box; }

  body {
    font-family: 'JetBrains Mono', monospace;
    background: var(--bg);
    color: var(--text);
    min-height: 100vh;
    overflow-x: hidden;
  }

  /* GRID BACKGROUND */
  body::before {
    content:'';
    position:fixed; inset:0;
    background-image:
      linear-gradient(rgba(0,212,170,0.03) 1px, transparent 1px),
      linear-gradient(90deg, rgba(0,212,170,0.03) 1px, transparent 1px);
    background-size: 40px 40px;
    pointer-events:none;
    z-index:0;
  }

  /* ── HEADER ── */
  header {
    position: relative; z-index:10;
    display:flex; align-items:center; justify-content:space-between;
    padding: 18px 32px;
    border-bottom: 1px solid var(--border);
    background: rgba(5,8,16,0.95);
    backdrop-filter: blur(12px);
  }

  .logo-block { display:flex; align-items:center; gap:14px; }
  .logo-mark {
    width:36px; height:36px;
    background: linear-gradient(135deg, var(--accent), var(--accent2));
    clip-path: polygon(50% 0%,100% 25%,100% 75%,50% 100%,0% 75%,0% 25%);
    position:relative;
    animation: pulse 3s ease-in-out infinite;
  }
  @keyframes pulse { 0%,100%{opacity:1;} 50%{opacity:0.7;} }

  .logo-text { font-family:'Syne',sans-serif; font-size:20px; font-weight:800; letter-spacing:-0.5px; }
  .logo-text span { color: var(--accent); }
  .logo-sub { font-size:10px; color:var(--text3); letter-spacing:2px; text-transform:uppercase; }

  .header-meta { display:flex; align-items:center; gap:24px; }
  .live-badge {
    display:flex; align-items:center; gap:6px;
    padding:4px 10px; border-radius:4px;
    border:1px solid rgba(0,212,170,0.3);
    background: rgba(0,212,170,0.08);
    font-size:10px; color:var(--accent); letter-spacing:1.5px;
  }
  .live-dot {
    width:6px; height:6px; border-radius:50%;
    background:var(--accent);
    animation: blink 1.2s ease-in-out infinite;
  }
  @keyframes blink { 0%,100%{opacity:1;} 50%{opacity:0.2;} }

  .timestamp { font-size:11px; color:var(--text3); }

  /* ── NAV TABS ── */
  .nav-tabs {
    display:flex; gap:0;
    padding: 0 32px;
    background: var(--bg2);
    border-bottom: 1px solid var(--border);
    position:relative; z-index:9;
  }
  .tab {
    padding:12px 20px; font-size:11px; letter-spacing:1.5px; text-transform:uppercase;
    color:var(--text3); cursor:pointer; border-bottom:2px solid transparent;
    transition:all 0.2s;
  }
  .tab:hover { color:var(--text2); }
  .tab.active { color:var(--accent); border-bottom-color:var(--accent); }

  /* ── MAIN LAYOUT ── */
  main {
    position:relative; z-index:1;
    max-width:1600px; margin:0 auto;
    padding: 24px 32px;
    display:flex; flex-direction:column; gap:20px;
  }

  /* ── KPI ROW ── */
  .kpi-row {
    display:grid;
    grid-template-columns: repeat(6, 1fr);
    gap:12px;
  }

  .kpi-card {
    background: var(--surface);
    border: 1px solid var(--border);
    border-radius:8px;
    padding:16px 18px;
    position:relative;
    overflow:hidden;
    transition: border-color 0.2s, transform 0.2s;
    animation: fadeIn 0.5s ease both;
  }
  .kpi-card:hover { border-color:var(--border2); transform:translateY(-1px); }
  .kpi-card::after {
    content:'';
    position:absolute; top:0; left:0; right:0; height:2px;
  }
  .kpi-card.green::after { background: linear-gradient(90deg, var(--green), transparent); }
  .kpi-card.red::after   { background: linear-gradient(90deg, var(--red), transparent); }
  .kpi-card.blue::after  { background: linear-gradient(90deg, var(--accent2), transparent); }
  .kpi-card.gold::after  { background: linear-gradient(90deg, var(--gold), transparent); }
  .kpi-card.teal::after  { background: linear-gradient(90deg, var(--accent), transparent); }
  .kpi-card.orange::after { background: linear-gradient(90deg, var(--accent3), transparent); }

  .kpi-label { font-size:9px; color:var(--text3); letter-spacing:2px; text-transform:uppercase; margin-bottom:8px; }
  .kpi-value { font-family:'Syne',sans-serif; font-size:22px; font-weight:700; line-height:1; }
  .kpi-value.up { color:var(--green); }
  .kpi-value.down { color:var(--red); }
  .kpi-value.neutral { color:var(--text); }
  .kpi-value.blue { color:var(--accent2); }
  .kpi-value.gold { color:var(--gold); }
  .kpi-sub { font-size:10px; color:var(--text3); margin-top:4px; }

  @keyframes fadeIn {
    from { opacity:0; transform:translateY(8px); }
    to   { opacity:1; transform:translateY(0); }
  }
  .kpi-card:nth-child(1) { animation-delay:0.05s }
  .kpi-card:nth-child(2) { animation-delay:0.1s }
  .kpi-card:nth-child(3) { animation-delay:0.15s }
  .kpi-card:nth-child(4) { animation-delay:0.2s }
  .kpi-card:nth-child(5) { animation-delay:0.25s }
  .kpi-card:nth-child(6) { animation-delay:0.3s }

  /* ── CHART SECTION ── */
  .charts-row {
    display:grid;
    grid-template-columns: 2fr 1fr;
    gap:16px;
  }

  .chart-card {
    background: var(--surface);
    border: 1px solid var(--border);
    border-radius:8px;
    overflow:hidden;
  }

  .card-header {
    display:flex; align-items:center; justify-content:space-between;
    padding:14px 18px;
    border-bottom:1px solid var(--border);
    background: var(--bg2);
  }
  .card-title {
    font-family:'Syne',sans-serif;
    font-size:13px; font-weight:700; letter-spacing:0.5px;
  }
  .card-title span { color:var(--text3); font-size:11px; font-weight:400; margin-left:8px; }
  .card-badge {
    font-size:9px; padding:3px 8px; border-radius:3px; letter-spacing:1px; text-transform:uppercase;
  }
  .badge-green { background:rgba(46,213,115,0.15); color:var(--green); border:1px solid rgba(46,213,115,0.3); }
  .badge-blue  { background:rgba(0,153,255,0.15);  color:var(--accent2); border:1px solid rgba(0,153,255,0.3); }
  .badge-teal  { background:rgba(0,212,170,0.15);  color:var(--accent);  border:1px solid rgba(0,212,170,0.3); }

  canvas { display:block; }

  /* ── BOTTOM ROW ── */
  .bottom-row {
    display:grid;
    grid-template-columns: 1.4fr 1fr;
    gap:16px;
  }

  /* ── TABLE ── */
  .table-wrap { overflow:auto; max-height:380px; }
  table { width:100%; border-collapse:collapse; font-size:11px; }
  thead th {
    position:sticky; top:0; z-index:2;
    padding:10px 14px;
    text-align:left;
    font-size:9px; letter-spacing:1.5px; text-transform:uppercase;
    color:var(--text3);
    background:var(--bg2);
    border-bottom:1px solid var(--border);
    white-space:nowrap;
    cursor:pointer;
    user-select:none;
    transition:color 0.2s;
  }
  thead th:hover { color:var(--accent); }
  thead th.sorted { color:var(--accent); }

  tbody tr {
    border-bottom:1px solid rgba(30,45,69,0.5);
    transition:background 0.15s;
  }
  tbody tr:hover { background: rgba(0,212,170,0.04); }

  td { padding:9px 14px; white-space:nowrap; }
  .ticker { color:var(--accent); font-weight:600; letter-spacing:0.5px; }
  .pos-type {
    font-size:9px; padding:2px 7px; border-radius:3px; letter-spacing:1px;
    font-weight:500;
  }
  .long  { background:rgba(46,213,115,0.1); color:var(--green);  border:1px solid rgba(46,213,115,0.2); }
  .short { background:rgba(255,71,87,0.1);  color:var(--red);    border:1px solid rgba(255,71,87,0.2); }

  .pnl-pos { color:var(--green); }
  .pnl-neg { color:var(--red); }

  .weight-bar {
    display:flex; align-items:center; gap:8px;
  }
  .bar-bg {
    flex:1; height:4px; background:var(--border); border-radius:2px; overflow:hidden;
  }
  .bar-fill {
    height:100%; border-radius:2px;
    transition:width 1s ease;
  }

  /* ── ATTRIBUTION CHART ── */
  .attrib-list { padding:16px; display:flex; flex-direction:column; gap:12px; }
  .attrib-item { }
  .attrib-head {
    display:flex; justify-content:space-between; align-items:center;
    margin-bottom:5px;
  }
  .attrib-name { font-size:11px; color:var(--text2); }
  .attrib-pnl  { font-size:12px; font-weight:600; }
  .attrib-bar-bg {
    height:6px; background:var(--border); border-radius:3px; overflow:hidden;
  }
  .attrib-bar {
    height:100%; border-radius:3px;
    transition: width 1.2s ease;
  }

  /* ── RISK METRICS ── */
  .risk-grid { padding:16px; display:flex; flex-direction:column; gap:10px; }
  .risk-row {
    display:flex; align-items:center; justify-content:space-between;
    padding:10px 14px;
    background:var(--bg2);
    border:1px solid var(--border);
    border-radius:6px;
  }
  .risk-label { font-size:10px; color:var(--text3); letter-spacing:1px; text-transform:uppercase; }
  .risk-val   { font-size:14px; font-weight:600; font-family:'Syne',sans-serif; }

  /* ── FOOTER ── */
  footer {
    position:relative; z-index:1;
    display:flex; align-items:center; justify-content:space-between;
    padding:14px 32px;
    border-top:1px solid var(--border);
    background:rgba(5,8,16,0.9);
    font-size:10px; color:var(--text3);
  }
  .footer-pills { display:flex; gap:16px; }
  .pill {
    display:flex; align-items:center; gap:5px;
  }
  .pill-dot { width:5px; height:5px; border-radius:50%; }

  /* ── SCROLLBAR ── */
  ::-webkit-scrollbar { width:5px; height:5px; }
  ::-webkit-scrollbar-track { background:var(--bg2); }
  ::-webkit-scrollbar-thumb { background:var(--border2); border-radius:3px; }

  /* ── BENCHMARK LEGEND ── */
  .legend { display:flex; gap:16px; align-items:center; }
  .leg-item { display:flex; gap:6px; align-items:center; font-size:10px; color:var(--text3); }
  .leg-line { width:20px; height:2px; border-radius:1px; }

  /* ── ROLLING WINDOW BUTTONS ── */
  .window-btns { display:flex; gap:4px; }
  .wbtn {
    padding:3px 9px; font-size:9px; border-radius:3px; letter-spacing:1px;
    border:1px solid var(--border); background:transparent; color:var(--text3);
    cursor:pointer; transition:all 0.15s; font-family:'JetBrains Mono',monospace;
  }
  .wbtn:hover, .wbtn.active { border-color:var(--accent); color:var(--accent); background:rgba(0,212,170,0.08); }

  .section-label {
    font-size:9px; letter-spacing:2px; text-transform:uppercase; color:var(--text3);
    padding:0 0 8px;
    border-bottom:1px solid var(--border);
    margin-bottom:12px;
  }
</style>
</head>
<body>

<!-- HEADER -->
<header>
  <div class="logo-block">
    <div class="logo-mark"></div>
    <div>
      <div class="logo-text">Trade<span>Metrics</span></div>
      <div class="logo-sub">Portfolio Analytics Engine</div>
    </div>
  </div>
  <div class="header-meta">
    <div class="live-badge">
      <div class="live-dot"></div>
      IBKR CONNECTED
    </div>
    <div class="timestamp" id="ts"></div>
  </div>
</header>

<!-- NAV -->
<div class="nav-tabs">
  <div class="tab active" onclick="setTab(this,'overview')">Overview</div>
  <div class="tab" onclick="setTab(this,'attribution')">P&L Attribution</div>
  <div class="tab" onclick="setTab(this,'risk')">Risk Engine</div>
  <div class="tab" onclick="setTab(this,'positions')">Positions</div>
</div>

<!-- MAIN -->
<main>

  <!-- KPI ROW -->
  <div class="kpi-row">
    <div class="kpi-card green">
      <div class="kpi-label">Total Return</div>
      <div class="kpi-value up">+34.7%</div>
      <div class="kpi-sub">vs SPY +24.1%</div>
    </div>
    <div class="kpi-card blue">
      <div class="kpi-label">Sharpe Ratio</div>
      <div class="kpi-value blue">1.84</div>
      <div class="kpi-sub">12-month rolling</div>
    </div>
    <div class="kpi-card red">
      <div class="kpi-label">Max Drawdown</div>
      <div class="kpi-value down">−12.3%</div>
      <div class="kpi-sub">Sep 2024 peak→trough</div>
    </div>
    <div class="kpi-card gold">
      <div class="kpi-label">Portfolio Value</div>
      <div class="kpi-value gold">€47,820</div>
      <div class="kpi-sub">+€12,340 YTD</div>
    </div>
    <div class="kpi-card teal">
      <div class="kpi-label">Win Rate</div>
      <div class="kpi-value neutral">68.4%</div>
      <div class="kpi-sub">26/38 closed trades</div>
    </div>
    <div class="kpi-card orange">
      <div class="kpi-label">Sortino Ratio</div>
      <div class="kpi-value neutral" style="color:var(--accent3)">2.31</div>
      <div class="kpi-sub">downside σ adjusted</div>
    </div>
  </div>

  <!-- CHARTS ROW -->
  <div class="charts-row">

    <!-- CUMULATIVE RETURN CHART -->
    <div class="chart-card" id="perfCard">
      <div class="card-header">
        <div>
          <div class="card-title">Cumulative Performance <span>vs Benchmark</span></div>
        </div>
        <div style="display:flex;align-items:center;gap:14px;">
          <div class="legend">
            <div class="leg-item"><div class="leg-line" style="background:var(--accent)"></div>Portfolio</div>
            <div class="leg-item"><div class="leg-line" style="background:var(--accent2)"></div>SPY</div>
            <div class="leg-item"><div class="leg-line" style="background:rgba(255,107,53,0.6)"></div>QQQ</div>
          </div>
          <div class="window-btns">
            <button class="wbtn" onclick="setWindow(1,'3M')">3M</button>
            <button class="wbtn" onclick="setWindow(2,'6M')">6M</button>
            <button class="wbtn active" onclick="setWindow(3,'1Y')">1Y</button>
          </div>
          <div class="card-badge badge-green">+10.6% ALPHA</div>
        </div>
      </div>
      <canvas id="perfChart" height="200"></canvas>
    </div>

    <!-- MONTHLY RETURNS HEATMAP-STYLE BAR -->
    <div class="chart-card">
      <div class="card-header">
        <div class="card-title">Monthly Returns</div>
        <div class="card-badge badge-teal">2024–2025</div>
      </div>
      <canvas id="monthChart" height="200"></canvas>
    </div>
  </div>

  <!-- BOTTOM ROW -->
  <div class="bottom-row">

    <!-- POSITIONS TABLE -->
    <div class="chart-card">
      <div class="card-header">
        <div class="card-title">Open Positions <span>Live P&L</span></div>
        <div class="card-badge badge-blue">38 TRADES YTD</div>
      </div>
      <div class="table-wrap">
        <table id="posTable">
          <thead>
            <tr>
              <th onclick="sortTable(0)">Ticker</th>
              <th onclick="sortTable(1)">Type</th>
              <th onclick="sortTable(2)">Entry</th>
              <th onclick="sortTable(3)">Current</th>
              <th onclick="sortTable(4)">P&L €</th>
              <th onclick="sortTable(5)">P&L %</th>
              <th onclick="sortTable(6)">Weight</th>
              <th onclick="sortTable(7)">Sharpe</th>
            </tr>
          </thead>
          <tbody id="posBody"></tbody>
        </table>
      </div>
    </div>

    <!-- RISK + ATTRIB COLUMN -->
    <div style="display:flex;flex-direction:column;gap:16px;">

      <!-- P&L ATTRIBUTION -->
      <div class="chart-card">
        <div class="card-header">
          <div class="card-title">P&L Attribution <span>by sector</span></div>
          <div class="card-badge badge-green">TOP CONTRIBUTORS</div>
        </div>
        <div class="attrib-list" id="attribList"></div>
      </div>

      <!-- RISK METRICS -->
      <div class="chart-card">
        <div class="card-header">
          <div class="card-title">Risk Metrics</div>
          <div class="card-badge badge-teal">VAR 95%</div>
        </div>
        <div class="risk-grid">
          <div class="risk-row">
            <span class="risk-label">Daily VaR (95%)</span>
            <span class="risk-val" style="color:var(--red)">−€621</span>
          </div>
          <div class="risk-row">
            <span class="risk-label">Beta (vs SPY)</span>
            <span class="risk-val" style="color:var(--accent2)">1.34</span>
          </div>
          <div class="risk-row">
            <span class="risk-label">Portfolio σ (ann.)</span>
            <span class="risk-val" style="color:var(--text)">18.7%</span>
          </div>
          <div class="risk-row">
            <span class="risk-label">Calmar Ratio</span>
            <span class="risk-val" style="color:var(--green)">2.82</span>
          </div>
          <div class="risk-row">
            <span class="risk-label">Avg Hold Period</span>
            <span class="risk-val" style="color:var(--text)">23.4 days</span>
          </div>
        </div>
      </div>

    </div>
  </div>

</main>

<footer>
  <div>TradeMetrics v2.1 · IBKR API Integration · Python Analytics Engine</div>
  <div class="footer-pills">
    <div class="pill"><div class="pill-dot" style="background:var(--green)"></div>20 open positions</div>
    <div class="pill"><div class="pill-dot" style="background:var(--accent)"></div>Data refreshed 09:31 UTC</div>
    <div class="pill"><div class="pill-dot" style="background:var(--accent2)"></div>Leveraged equity · IBKR Pro</div>
  </div>
</footer>

<!-- CHART.JS -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/4.4.1/chart.umd.min.js"></script>
<script>
// ── TIMESTAMP ──
function updateTS() {
  const now = new Date();
  document.getElementById('ts').textContent = now.toUTCString().replace('GMT','UTC');
}
updateTS(); setInterval(updateTS,1000);

// ── TAB LOGIC ──
function setTab(el, id) {
  document.querySelectorAll('.tab').forEach(t=>t.classList.remove('active'));
  el.classList.add('active');
}

// ── GENERATE REALISTIC PRICE PATH ──
function genPath(n, start, drift, vol, seed) {
  let r = [start]; let s = seed;
  for(let i=1;i<n;i++){
    s = (s*1664525+1013904223)&0xffffffff;
    const u = (s/0xffffffff)*2-1;
    s = (s*1664525+1013904223)&0xffffffff;
    const v = (s/0xffffffff)*2-1;
    const z = u*Math.sqrt(-2*Math.log(Math.max(1e-10,u*u+v*v))/(u*u+v*v+1e-10));
    r.push(r[i-1]*(1 + drift/252 + vol/Math.sqrt(252)*z*0.7));
  }
  return r;
}

function toCumRet(path) {
  return path.map(v => ((v/path[0])-1)*100);
}

// DATES (trading days ~252/year)
const N = 252;
const labels = [];
const start = new Date('2024-02-17');
let d = new Date(start);
for(let i=0;i<N;i++){
  while([0,6].includes(d.getDay())) d.setDate(d.getDate()+1);
  labels.push(d.toLocaleDateString('en-GB',{month:'short',day:'numeric'}));
  d.setDate(d.getDate()+1);
}

// Paths
const porto = genPath(N,100,0.347,0.187,42);
const spy   = genPath(N,100,0.241,0.12,17);
const qqq   = genPath(N,100,0.29,0.16,99);

const portRet = toCumRet(porto);
const spyRet  = toCumRet(spy);
const qqqRet  = toCumRet(qqq);

// ── DRAWDOWN FILL ──
function makeGradient(ctx, c1, c2) {
  const g = ctx.createLinearGradient(0,0,0,300);
  g.addColorStop(0, c1); g.addColorStop(1, c2);
  return g;
}

// ── PERFORMANCE CHART ──
let perfChart;
function buildPerfChart(sliceStart=0) {
  const ctx = document.getElementById('perfChart').getContext('2d');
  const sl = n => n.slice(sliceStart);
  if(perfChart) perfChart.destroy();
  const grad = ctx.createLinearGradient(0,0,0,280);
  grad.addColorStop(0,'rgba(0,212,170,0.25)');
  grad.addColorStop(1,'rgba(0,212,170,0)');

  perfChart = new Chart(ctx,{
    type:'line',
    data:{
      labels: sl(labels),
      datasets:[
        {
          label:'Portfolio',
          data: sl(portRet),
          borderColor:'#00d4aa',
          borderWidth:2,
          backgroundColor: grad,
          fill:true,
          tension:0.4,
          pointRadius:0,
          pointHoverRadius:4,
          pointHoverBackgroundColor:'#00d4aa',
        },
        {
          label:'SPY',
          data: sl(spyRet),
          borderColor:'rgba(0,153,255,0.7)',
          borderWidth:1.5,
          backgroundColor:'transparent',
          fill:false,
          tension:0.4,
          pointRadius:0,
          borderDash:[4,4],
        },
        {
          label:'QQQ',
          data: sl(qqqRet),
          borderColor:'rgba(255,107,53,0.5)',
          borderWidth:1.5,
          backgroundColor:'transparent',
          fill:false,
          tension:0.4,
          pointRadius:0,
          borderDash:[2,4],
        }
      ]
    },
    options:{
      responsive:true,
      maintainAspectRatio:true,
      interaction:{mode:'index',intersect:false},
      plugins:{
        legend:{display:false},
        tooltip:{
          backgroundColor:'rgba(9,13,26,0.95)',
          borderColor:'#1e2d45',
          borderWidth:1,
          titleColor:'#8fa3c0',
          bodyColor:'#e8edf5',
          padding:10,
          callbacks:{
            label: ctx => ` ${ctx.dataset.label}: ${ctx.parsed.y>=0?'+':''}${ctx.parsed.y.toFixed(2)}%`
          }
        }
      },
      scales:{
        x:{
          grid:{color:'rgba(30,45,69,0.4)',drawTicks:false},
          ticks:{
            color:'#4a6080',
            font:{family:'JetBrains Mono',size:9},
            maxTicksLimit:8,
            maxRotation:0,
          },
          border:{color:'#1e2d45'}
        },
        y:{
          position:'right',
          grid:{color:'rgba(30,45,69,0.4)',drawTicks:false},
          ticks:{
            color:'#4a6080',
            font:{family:'JetBrains Mono',size:9},
            callback: v => (v>=0?'+':'')+v.toFixed(0)+'%'
          },
          border:{color:'#1e2d45'}
        }
      }
    }
  });
}

buildPerfChart(0);

function setWindow(w,label) {
  document.querySelectorAll('.wbtn').forEach(b=>b.classList.remove('active'));
  document.querySelectorAll('.wbtn')[w-1].classList.add('active');
  const starts = {1:N-63, 2:N-126, 3:0};
  buildPerfChart(Math.max(0,starts[w]));
}

// ── MONTHLY RETURNS CHART ──
const monthlyLabels = ['Feb\'24','Mar','Apr','May','Jun','Jul','Aug','Sep','Oct','Nov','Dec','Jan\'25','Feb\'25'];
const monthlyRets   = [3.1,-1.4,4.8,2.2,-3.1,5.7,1.8,-4.2,6.3,2.9,3.4,4.1,2.7];
const spyMonthly    = [2.1,-0.8,3.2,1.4,-2.2,3.9,0.9,-2.8,4.1,1.7,2.3,2.9,1.6];

new Chart(document.getElementById('monthChart'),{
  type:'bar',
  data:{
    labels:monthlyLabels,
    datasets:[
      {
        label:'Portfolio',
        data:monthlyRets,
        backgroundColor: monthlyRets.map(v=>v>=0?'rgba(46,213,115,0.75)':'rgba(255,71,87,0.75)'),
        borderColor: monthlyRets.map(v=>v>=0?'rgba(46,213,115,1)':'rgba(255,71,87,1)'),
        borderWidth:1,
        borderRadius:3,
      },
      {
        label:'SPY',
        data:spyMonthly,
        backgroundColor:'rgba(0,153,255,0.2)',
        borderColor:'rgba(0,153,255,0.5)',
        borderWidth:1,
        borderRadius:3,
      }
    ]
  },
  options:{
    responsive:true,
    maintainAspectRatio:true,
    plugins:{
      legend:{display:false},
      tooltip:{
        backgroundColor:'rgba(9,13,26,0.95)',
        borderColor:'#1e2d45',
        borderWidth:1,
        titleColor:'#8fa3c0',
        bodyColor:'#e8edf5',
        callbacks:{
          label: ctx => ` ${ctx.dataset.label}: ${ctx.parsed.y>=0?'+':''}${ctx.parsed.y.toFixed(1)}%`
        }
      }
    },
    scales:{
      x:{
        grid:{display:false},
        ticks:{color:'#4a6080',font:{family:'JetBrains Mono',size:8},maxRotation:45},
        border:{color:'#1e2d45'}
      },
      y:{
        position:'right',
        grid:{color:'rgba(30,45,69,0.4)'},
        ticks:{color:'#4a6080',font:{family:'JetBrains Mono',size:9},callback:v=>(v>=0?'+':'')+v+'%'},
        border:{color:'#1e2d45'}
      }
    }
  }
});

// ── POSITIONS DATA ──
const positions = [
  {ticker:'MSFT', type:'LONG', entry:375.20, current:442.80, pnl:1351,pct:18.0, weight:15.2, sharpe:2.1, color:'#2ed573'},
  {ticker:'ORCL', type:'LONG', entry:118.40, current:159.30, pnl:818,pct:34.5, weight:12.8, sharpe:2.4, color:'#2ed573'},
  {ticker:'RBLX', type:'LONG', entry:44.10,  current:55.80,  pnl:234,pct:26.5, weight:8.4,  sharpe:1.7, color:'#2ed573'},
  {ticker:'NVDA', type:'LONG', entry:612.00, current:890.00, pnl:2780,pct:45.4, weight:14.1, sharpe:2.8, color:'#2ed573'},
  {ticker:'META', type:'LONG', entry:488.00, current:527.00, pnl:390,pct:8.0,  weight:9.7,  sharpe:1.4, color:'#2ed573'},
  {ticker:'AMD',  type:'LONG', entry:172.00, current:154.00, pnl:-360,pct:-10.5, weight:7.2, sharpe:0.8, color:'#ff4757'},
  {ticker:'SPY',  type:'SHORT', entry:521.00, current:537.00, pnl:-320,pct:-3.1, weight:8.0, sharpe:0.5, color:'#ff4757'},
  {ticker:'PLTR', type:'LONG', entry:18.20,  current:24.60,  pnl:192,pct:35.2, weight:4.8,  sharpe:1.9, color:'#2ed573'},
  {ticker:'TSLA', type:'LONG', entry:241.00, current:196.00, pnl:-450,pct:-18.7, weight:5.6, sharpe:0.3, color:'#ff4757'},
  {ticker:'CRM',  type:'LONG', entry:298.00, current:321.00, pnl:230,pct:7.7,  weight:4.2,  sharpe:1.2, color:'#2ed573'},
  {ticker:'GOOGL',type:'LONG', entry:174.00, current:199.00, pnl:500,pct:14.4, weight:6.8,  sharpe:1.6, color:'#2ed573'},
  {ticker:'AMZN', type:'LONG', entry:193.00, current:228.00, pnl:700,pct:18.1, weight:5.9,  sharpe:1.8, color:'#2ed573'},
];

function buildTable() {
  const tbody = document.getElementById('posBody');
  tbody.innerHTML = '';
  positions.forEach(p=>{
    const isPos = p.pnl>=0;
    const maxW = Math.max(...positions.map(x=>x.weight));
    const bar = `<div class="weight-bar">
      <span style="min-width:36px">${p.weight}%</span>
      <div class="bar-bg"><div class="bar-fill" style="width:${(p.weight/maxW*100).toFixed(0)}%;background:${isPos?'var(--accent)':'var(--accent3)'}"></div></div>
    </div>`;
    tbody.innerHTML+=`<tr>
      <td class="ticker">${p.ticker}</td>
      <td><span class="pos-type ${p.type.toLowerCase()}">${p.type}</span></td>
      <td>€${p.entry.toFixed(2)}</td>
      <td>€${p.current.toFixed(2)}</td>
      <td class="${isPos?'pnl-pos':'pnl-neg'}">${isPos?'+':''}€${p.pnl}</td>
      <td class="${isPos?'pnl-pos':'pnl-neg'}">${isPos?'+':''}${p.pct}%</td>
      <td>${bar}</td>
      <td style="color:${p.sharpe>=1.5?'var(--green)':p.sharpe>=1?'var(--accent)':'var(--red)'}">${p.sharpe.toFixed(2)}</td>
    </tr>`;
  });
}
buildTable();

// ── SORT ──
let sortDir=1, sortCol=4;
function sortTable(col){
  if(sortCol===col) sortDir*=-1; else { sortCol=col; sortDir=-1; }
  const keys=['ticker','type','entry','current','pnl','pct','weight','sharpe'];
  positions.sort((a,b)=>{
    const av=a[keys[col]], bv=b[keys[col]];
    return typeof av==='string'?av.localeCompare(bv)*sortDir:(av-bv)*sortDir;
  });
  buildTable();
  document.querySelectorAll('thead th').forEach((th,i)=>{
    th.classList.toggle('sorted',i===col);
    th.textContent = ['Ticker','Type','Entry','Current','P&L €','P&L %','Weight','Sharpe'][i]
      + (i===col?(sortDir>0?' ↑':' ↓'):'');
  });
}

// ── P&L ATTRIBUTION ──
const attribs = [
  {name:'Technology', pnl:5201, max:5201, color:'#2ed573'},
  {name:'Cloud / SaaS', pnl:2340, max:5201, color:'#00d4aa'},
  {name:'Semiconductors', pnl:2780, max:5201, color:'#0099ff'},
  {name:'Short Hedges', pnl:-320, max:5201, color:'#ff4757'},
  {name:'Consumer Tech', pnl:-810, max:5201, color:'#ff6b35'},
];

const attribList = document.getElementById('attribList');
attribs.forEach(a=>{
  const pct = (Math.abs(a.pnl)/a.max*100).toFixed(0);
  attribList.innerHTML+=`<div class="attrib-item">
    <div class="attrib-head">
      <span class="attrib-name">${a.name}</span>
      <span class="attrib-pnl" style="color:${a.pnl>=0?'var(--green)':'var(--red)'}">${a.pnl>=0?'+':''}€${a.pnl.toLocaleString()}</span>
    </div>
    <div class="attrib-bar-bg">
      <div class="attrib-bar" style="width:0%;background:${a.color}" data-w="${pct}"></div>
    </div>
  </div>`;
});

// Animate bars on load
setTimeout(()=>{
  document.querySelectorAll('.attrib-bar').forEach(b=>{
    b.style.width = b.dataset.w+'%';
  });
  document.querySelectorAll('.bar-fill').forEach(b=>{
    // already set via inline
  });
},100);

// ── TICKER ──
const tickers = [
  {t:'NVDA',p:'+2.41%',v:'green'},{t:'MSFT',p:'+0.83%',v:'green'},
  {t:'ORCL',p:'+1.22%',v:'green'},{t:'META',p:'-0.31%',v:'red'},
  {t:'AMD', p:'-1.17%',v:'red'}, {t:'PLTR',p:'+3.44%',v:'green'},
  {t:'AMZN',p:'+0.61%',v:'green'},{t:'GOOGL',p:'+0.91%',v:'green'},
];
</script>
</body>
</html>
